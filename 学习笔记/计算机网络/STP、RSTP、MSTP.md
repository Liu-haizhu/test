# STP
1、生成树的作用：
可以起到防止链路形成环路、冗余链路的作用，提高网络的可靠性。

2、二层环路造成的影响：
形成广播风暴、MAC地址震荡、重复首发数据帧。

3、STP端口角色：
根端口、指定端口、预备端口(被阻塞的端口)

4、BPDU报文：
在生成树选举根桥根端口这一系列中的所有信息都会被包含在BPDU报文中，通过转发BPDU报文了解设备彼此之间的信息。BPDU报文都包含桥ID、路径开销、端口PID。

4、根桥选举过程：
根桥的选举是依靠桥ID(BID)，谁的桥ID越小谁就是根桥，优先级的数值越小越优先；4096>32748，当优先级相同时比较MAC地址，谁的MAC地址小谁就是根桥；4c1f-cc4e-7789<4c1f-ccf2-0bdb
(1)、桥ID的组成：
桥ID是由16位优先级(默认32768是4096的8倍)和48位的MAC地址组成

5、根端口选举过程：
根端口的选举分别是查看路径开销Cost、对端设备的桥ID、对端设备的PID和本段的PID，先查看该端口到根桥的路径总的开销是是否是最小==(一般情况下是带宽越高的路径开销值越小)==，若开销值为最小则是最优路径，则为根端口。当路径开销值相同时则查看BID通过查看发送者BPDU报文中谁的BID最小则谁为根端口，当开销值和BID都相同时，则查看收到对端接口发送的BPDU中的PID谁的PID小则谁为根端口。一般情况下连接根桥的交换机接口都是根端口。
(1)PID端口ID的组成：端口优先级+端口号组成，端口优先级范围0-240是16的倍数默认为128

6、STP的五种端口状态和作用：
![[Pasted image 20240701163315.png]]





STP选举根桥过程：
![[Pasted image 20240701160914.png]]
图中交换机优先级相同都为32768下面分别查看MAC地址
![[Pasted image 20240701161259.png]]
查看SW1的MAC地址
![[Pasted image 20240701161343.png]]
查看SW2的MAC地址
![[Pasted image 20240701161405.png]]
查看SW3的MAC地址
通过上述比较SW1、SW2和SW3的MAC地址得出SW3的MAC地址最小则SW3为根桥。
其次是根端口的选举，通过上述图能看出都是使用的1G带宽的链路所以开销值都是相同，选举出到达根桥的开销值最小的接口为根端口，可以得出SW1的G0/0/2和SW2的G0/0/2为根端口
![[Pasted image 20240701162634.png]]
![[Pasted image 20240701162624.png]]
再通过比较SW1的G0/0/1和SW2的G0/0/1端口选举出一个根端口，开销值都是相同的通过比较MAC地址的大小得出SW1的MAC地址比SW2的小所以SW1的G0/0/1接口为根端口，通过根桥出来的端口一般为指定端口，所以最后得出SW2的G0/0/1接口为阻塞端口。
![[Pasted image 20240701162951.png]]






# Cisco配置PVST
```js
#选择生成树模式为pvst
Switch(config)#spanning-tree mode pvst
#绑定vlan10，20，30优先级为8192vlan40，50，60优先级为4096
Switch(config)#spanning-tree vlan 10,20,30 priority 8192
Switch(config)#spanning-tree vlan 40,50,60 priority 4096


```